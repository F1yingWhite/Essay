## 使用数据
在数据上使用的是肺部的两类癌症数据，构建肺部癌症上的二分类任务
[CPTAC-LSCC](https://www.cancerimagingarchive.net/?swp_form%5Bform_id%5D=1&s=CPTAC-LSCC)
[CPTAC-LUAD](https://www.cancerimagingarchive.net/collection/cptac-luad/)
这两个数据集有CT+对应的病理图片的图片
为了补充CT图像的数量,有找了一个新的肺癌数据集[Lung-PET-CT-Dx](https://www.cancerimagingarchive.net/collection/lung-pet-ct-dx/),该数据集只有CT图像
## 数据预处理
### 病理图片预处理
病理图片使用算法检测出前景并且将其按照125um的大小进行切分,分割为224\*224\*3像素的png图片,并且从每张图中随机获取32个区块.分割示意图以及保存的图片如下所示
![[Pasted image 20240703202744.png]]
为了消除染色可能导致的颜色不一致问题,使用算法[Vahadane](https://blog.csdn.net/qq_34616741/article/details/100541893)进行归一化。归一化后基本消除了色差,该算法的效果较好,缺点是运行时间很长..
![[Pasted image 20240703202930.png]]
处理完毕后,二类的图片数量均为2w张左右,以WSI为单位进行按照2:8的概率划分测试集和训练集
### CT图像预处理
由于下载得到的CT图像较为混乱并且没有给出对应的文件说明,因此CT图像的处理上较为简单.由于原始图像的大小多为512\*512\*n,我将Dicom图像转为256\*256*\n的nii格式文件进行计算
![[Pasted image 20240703203416.png]]
模型得到的数据存在一定的数据不平衡问题,两类的比例为
0的个数为: 187
1的个数为: 794
## 单模态模型训练
### 病理图像训练
训练时采用随机旋转15°+随机水平/垂直翻转的数据增强进行操作
模型上选择resnet50进行训练,使用交叉熵损失函数,训练210个epoch后在测试集上的准确率为85%(87-81)
## CT图像训练
训练是使用随机x轴方向上15°的随机旋转+x轴随机平移(平移幅度为10%图像大小)
CT图像上采用Resnet50-3D进行训练,使用Focal loss损失函数,在图像大小为512\*512条件下得到的准确率为:0.8177(0.7111:0.8503)
## 多模态训练
![[Pasted image 20240703205733.png]]
我在以上两种情况(严重缺失模态和单模态)下进行了训练
## 双模态训练
得到的结果如下所示
